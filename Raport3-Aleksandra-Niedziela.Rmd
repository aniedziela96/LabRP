---
title: "Raport 3"
author: "Aleksandra Niedziela"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    dev: cairo_pdf
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(ggplot2)
```

# Problem kolekcjonera kuponów

Aby wygrać w konkursie potrzebujemy $n$ kuponów. Interesuje nas liczba pudełek $X_n$, po których zakupie otrzymamy nagrodę. Liczba $X_n$ to zmienna losowa. 
Przyjmijmy, że mamy już $k - 1$ kuponów, niech $X_{n,k}$ będzie liczbą pudełek, które musimy kupić, aby posiadać $k$ kuponów.

- $X_{n,k}$ to zmienna losowa, o rozkładzie geometrycznym z parametrem $\frac{n - k + 1}{n}$ 
- $X_n = X_{n, 1} + X_{n, 2} + \ldots + X_{n, n} = \sum_{k = 1}^{n}X_{n,k}$

Policzmy teraz wartość oczekiwaną zmiennej $X_n$

$$E[X_n] = \sum_{k = 1}^{n}\frac{n}{n - k + 1} = n \sum_{k = 0}^{n - 1}\frac{1}{n - k} = n \sum_{k = 1}^{n}\frac{1}{k}$$

## Symulacja 

Przeprowadźmy teraz symulację, za pomocą poniższej funckji

```{r teoretical_boxes, echo = FALSE}
theoretical_boxes <- function(n){
  return(n * sum(1/(1:n)))
}

```

```{r boxes_function, echo = TRUE}
boxes <- function(n){
  coupons <- 1:n
  aquired_coupons <- numeric(n)
  prize <- sum(1:n)
  a <- 0

  while (sum(aquired_coupons) != prize){
    coupon <- sample(1:n, 1)
    aquired_coupons[coupon] = coupon
    a <- a + 1
  }
  return(a)
}
```

```{r symulation_1, echo = FALSE}
n_values <- c(10, 25, 100, 500, 1000)
teoretical_boxes_number <- numeric(5)
experimental_boxel_number <- numeric(5)
for (i in 1:5) {
  n <- n_values[i]
  teoretical_boxes_number[i] <- theoretical_boxes(n)
  experimental_boxel_number[i] <- boxes(n)
}

data_1 <- data.frame(n_values, 
                     teoretical_boxes_number,
                     experimental_boxel_number)
```

Wyniki możemy przedstawić w tabeli: 

```{r table_1, echo = FALSE}
kable(head(data_1[, 1:3]),"latex", 
      digits = 0, 
      caption = "Porównanie wartości eksperymentalnych i teoretycznych",
      col.names = c("ilość kuponów",
                    "Wartość teoretyczna",
                    "Wartość eksperymentalna")) %>%
   kable_styling(font_size = 12, 
                 latex_options = "HOLD_position", 
                 position = "center")

```

Spójrzmy teraz na wykres pokazujący średnią liczbę pudełek (10 prób), po których zakupieniu zbierzemy wszystkie kupony

```{r symulation_2, echo = FALSE, cache = TRUE}
n_values <- 1:1000
experimental_boxes_number <- numeric(1000)
for (i in 1:1000) {
  boxes_sum <- 0
  for (j in 1:10) {
    n <- n_values[i]
    boxes_sum <- boxes_sum + boxes(n)
  }
  experimental_boxes_number[i] <- boxes_sum / 10
}

log_n <- n_values * log(n_values)
log_n_plus_1 <- n_values * (log(n_values) + 1)

data_2 <- data.frame(n_values, 
                     experimental_boxes_number,
                     log_n,
                     log_n_plus_1)

```

```{r plot_1, eval=TRUE, echo=FALSE, fig.height=4.5, fig.align='center'}
ggplot(data_2, aes(x = n_values)) +
  geom_point(aes(y = experimental_boxes_number), 
             size = 0.5) +
  geom_line(aes(y = log_n), 
            color = "blue", 
            linewidth = 1) +
  geom_line(aes(y = log_n_plus_1),
            color = "red", 
            linewidth = 1) +
  labs(x = "Liczba kuponów", y = "Liczba pudełek potrzebna do zebrania kuponów")
```

Czerwona i niebieska linia oznaczają ograniczenia wynikające z faktu:

$$\ln(n) < \sum_{k = 1}^{n}\frac{1}{k} < \ln(n) + 1$$
$$ n \cdot \ln(n) < E[X_n] < n \cdot (\ln(n) + 1)$$

# Nierówność Markowa 

Niech X będzie zmienną losową, która przyjmuje jedynie nieujemne wartości. Wtedy dla wszystkich a > 0,

$$P(X \ge a) \le \frac{E[X]}{a}$$

Korzystając z nierówności Markowa możemy oszacować prawdopodobieństwo uzyskania co najmniej $\frac{3n}{4}$ orłów w $n$ rzutach monetą. Przyjmijmy za zmienną losową $X_n$ liczbę wyrzuconych orłów w $n$ rzutach. Widzimy, iż jest to schemat Bernoulliego, gdzie prawdopodobieństwo sukcesu (wyrzucenia orła) wynosi $\frac{1}{2}$, stąd mamy:

$$E[X_n] = \frac{n}{2}$$

Teraz z nierówności Markowa otrzymujemy:

$$P(X_n \ge \frac{3n}{4}) \le \frac{\frac{n}{2}}{\frac{3n}{4}} = \frac{2}{3}$$

Możemy wyliczyć dokładne prawdopodobieństwa dla ustalonej ilości rzutów, a następnie zauważyć, że za każdym razem są one ograniczone przez $\frac{2}{3}$
 
```{r symulation_3, eval=TRUE, echo=FALSE}
n_values <- c(4, 10, 50, 100)
prob <- c()
for (i in 1:4){
  n <- n_values[i]
  prob <- c(prob, pbinom((0.75 * n) - 1, n, 0.5, lower.tail = FALSE))
}

data_3 <- data.frame(n_values, prob)

kable(head(data_3[, 1:2]),"latex", 
      digits = 8, 
      col.names = c("n",
                    "prawdopodobieństwo wyrzucenia 3n/4 orłów")) %>%
   kable_styling(font_size = 12, 
                 latex_options = "HOLD_position", 
                 position = "center", 
                 )
```

Zobaczmy teraz jak nierówność Markowa sprawdza się dla rozkładu normalnego, dla różnych wartości $a$. Wiemy, że dla rozkładu normalnego $N(\mu, \sigma)$, $E[X] = \mu$. Weźmy $\mu$ = 2 oraz $\sigma$ = 1. 

```{r plot_2, eval=TRUE, echo=FALSE, fig.height=4, fig.align='center'}
a <- seq(0, 4, 0.01)
prob <- pnorm(a, mean = 2, sd = 1, lower.tail = FALSE)
markow <- 2/a

data_4 <- data.frame(a, prob, markow)

ggplot(data_4, aes(x = a)) +
  geom_line(aes(y = prob), 
             linewidth = 1, 
            color = "red") +
  geom_line(aes(y = markow), 
            color = "blue", 
            linewidth = 1) +
  ylim(c(0, 1)) +
  labs(x = " ", y = " ", title = "Porównanie oszacowania, z wartością ogona dystrybuanty")
```
 



